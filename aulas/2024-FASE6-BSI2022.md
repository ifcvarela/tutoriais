# Aula 009 - (16/10/2024) Autentica√ß√£o e Autoriza√ß√£o

Revis√£o.

# Aula 008 - (09/10/2024) Autentica√ß√£o e Autoriza√ß√£o

- T√≥picos abordados
  - JWT (JSON Web Token)
  - Bcrypt
  - Middleware

# Aula 007 - (02/10/2024) Organizou o c√≥digo (visita do Reitor)

Nesta aula foi realizada a pr√°tica de organiza√ß√£o do c√≥digo do projeto de autentica√ß√£o e autoriza√ß√£o desenvolvido na aula anterior. O objetivo foi apresentar boas pr√°ticas de desenvolvimento de software, organiza√ß√£o de c√≥digo e arquitetura de software.

# Aula 006 - (25/09/2024) Autentica√ß√£o e Autoriza√ß√£o

Nesta aula foi realizada a pr√°tica de desenvolvimento de um sistema de autentica√ß√£o e autoriza√ß√£o utilizando Node.js, Express, Typescript. O projeto foi desenvolvido em conjunto com os alunos, com o objetivo de apresentar os conceitos e pr√°ticas de desenvolvimento de software. Tamb√©m foi apresentado o funcionamento do JWT (JSON Web Token) e sua utiliza√ß√£o.

- T√≥picos abordados
  - Autentica√ß√£o
  - Autoriza√ß√£o
  - JWT (JSON Web Token)
  - Middleware

## Exemplo de c√≥digo de uma api de autentica√ß√£o

```typescript
import crypto from 'crypto'
import express from 'express'
import cors from 'cors'

const app = express()

app.use(cors())
app.use(express.json())

const listaDeUsuariosRegistrados = [
  { id: 1, nome: 'u1', senha: 'p1' },
  { id: 2, nome: 'u2', senha: 'p1' },
]

let listaDeTokensGerados: { [k: string]: { id: number, nome: string } } = {
  // 
}

const isLogged: express.RequestHandler = (req, res, next) => {
  const token = req.headers.authorization
  if (!token)
    return res.status(401).json({ message: 'Token not found' })
  if (!listaDeTokensGerados[token])
    return res.status(401).json({ message: 'Invalid token' })
  next()
}

app.post('/login', (req, res) => {
  const { nome, senha } = req.body
  const usuarioEncontrado = listaDeUsuariosRegistrados.find(usuario => usuario.nome === nome && usuario.senha === senha)
  if (usuarioEncontrado === undefined)
    return res.status(401).json({ message: 'Invalid user' })
  const token = crypto.randomUUID()
  listaDeTokensGerados[token] = { nome, id: usuarioEncontrado.id }
  return res.status(200).json({ token })
})

app.post('/logout', (req, res) => {
  const token = req.headers.authorization
  if (!token)
    return res.status(401).json({ message: 'Token not found' })
  if (!listaDeTokensGerados[token])
    return res.status(401).json({ message: 'Invalid token' })
  delete listaDeTokensGerados[token]
  return res.status(200).json({ message: 'Logout success' })
})

app.post('/check', isLogged, (req, res) => {
  return res.status(200).json({ message: "DEU CERTO JOW!" })
})

app.post('/check2', isLogged, (req, res) => {
  return res.status(200).json({ message: "DEU CERTO JOW! TAMB√âM" })
})

app.listen(3333, () => console.log(`‚ö° Server is running on port ${PORT}`))
```

Para testar esta API voc√™ pode utilizar o [Insomnia](https://insomnia.rest/) ou [Postman](https://www.postman.com/), segue um exemplo de requisi√ß√µes para testar a API:

### Requisi√ß√£o de Login

```json
POST http://localhost:3333/login
Content-Type: application/json

{
  "nome": "u1",
  "senha": "p1"
}
```

### Requisi√ß√£o de Logout

```json
POST http://localhost:3333/logout
Authorization ??????????
```

### Requisi√ß√£o de Checagem

```json
POST http://localhost:3333/check
Authorization ??????????
```

## Exemplo de c√≥digo das fun√ß√µes para criar e verificar um JWT

```typescript
import jwt from 'jsonwebtoken'

const secret = 'sua chave secreata aqui'
const expiresIn = '1h'
const payload = {
  data: {
    nome: 'Daniel de Andrade Varela',
    id: 1
  }
}

// transforma as fun√ß√µes em promessasX
const sign = (payload: any, secret: string): Promise<string> => new Promise((r, x) => jwt.sign(payload, secret, { expiresIn }, (err, token) => err ? x(err) : r(<string>token)))
const verify = (token: string, secret: string): Promise<any> => new Promise((r, x) => jwt.verify(token, secret, (err, decoded) => err ? x(err) : r(decoded)))

// transforma as fun√ß√µes em promessas, c√≥digo mais legiveis
function sign_(payload: any, secret: string): Promise<string> {
  return new Promise((resolve, reject) => {
    jwt.sign(payload, secret, { expiresIn }, (err, token) => {
      if (err) return reject(err)
      resolve(token as string)
    })
  })
}

function verify_(token: string, secret: string): Promise<any> {
  return new Promise((resolve, reject) => {
    jwt.verify(token, secret, (err, decoded) => {
      if (err) return reject(err)
      resolve(decoded)
    })
  })
}

// exemplo de uso
void async function () {
  try {
    const token = await sign(payload, secret)
    console.log(token)
    
    const decoded = jwt.decode(token)
    console.log(decoded)
    
    const dataVerified = await verify(token, secret)
    console.log(dataVerified)
  } catch (error) {
    if (error instanceof jwt.TokenExpiredError)
      return console.error('Token expired')
    
    if (error instanceof jwt.NotBeforeError)
      return console.error('Token not before')
    
    if (error instanceof jwt.JsonWebTokenError)
      return console.error('Invalid token')
    
    console.error(error)
  }
}();
```


# Aula 005 - (18/09/2024) √± houve aula

Nesta aula n√£o houve aula, o professor n√£o pode comparecer por estar acompanhando visita t√©cnica da turma IA22 a Florian√≥polis no evento "Parque das Profiss√µes 2024: UDESC" e ao museu "Museu de Florian√≥polis - SESC".

# Aula 004 - (11/09/2024) Revis√£o e Autentica√ß√£o e Autoriza√ß√£o

Nesta aula foi realizada a revis√£o de conceitos e pr√°ticas, tamb√©m foi apresentado o conceito de autentica√ß√£o e autoriza√ß√£o, de maneira teorica.

- Topicos abordados
  - Revis√£o de conceitos
  - Autentica√ß√£o
  - Autoriza√ß√£o
  - JWT vs UUID
  - Servidores de Autentica√ß√£o
    - Centralizados
    - Distribuidos

# Aula 002 - PraÃÅtica de Desenvolvimento (Objeto de Estudos)

Nesta aula foi realizada a pr√°tica de desenvolvimento de um CRUD simples utilizando Node.js, Express, Typescript e SQLite. O projeto foi desenvolvido em conjunto com os alunos, com o objetivo de apresentar os conceitos e pr√°ticas de desenvolvimento de software.

Ainda utilizando o tutorial [CRUD Simples - Nodejs (express, typescript) - single server](../tutorial/crud-simples-monoservidor-nodejs-typescript-express-sqlite.md) como base.

- T√≥picos abordados
  - Inicializa√ß√£o de projeto
  - Instala√ß√£o de pacotes
  - Configura√ß√£o de ambiente de desenvolvimento
  - Desenvolvimento de rotas
  - Desenvolvimento de banco de dados
  - Node.js/NPM/Express
  - [Arrow Functions](https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Functions/Arrow_functions) 
  - [high order functions](https://developer.mozilla.org/pt-BR/docs/Glossary/Higher-order_function) 
  - [Callback](https://developer.mozilla.org/pt-BR/docs/Glossary/Callback_function)
  - [Promise](https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Promise)
  - [Async/Await](https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Statements/async_function)

> üí° Curiosidades Citadas em Aula
> 
> - Event Loop
>   - [üì∫ JavaScript Visualized - Event Loop, Web APIs, (Micro)task Queue](https://www.youtube.com/watch?v=eiC58R16hb8) 
>   - [üì∫ O que √© o Event Loop do JavaScript?](https://www.youtube.com/watch?v=8aGhZQkoFbQ)
> - Hoisting 
>   - [üì∫ Learn JavaScript Hoisting In 5 Minutes](https://www.youtube.com/watch?v=EvfRXyKa_GI) 
>   - [üì∫ Zero Dev S01E02: Hoisting na pr√°tica](https://www.youtube.com/watch?v=q-iKinPQks4)

# Aula 001 - Revis√£o e Conceitos

Nesta aula foi utilizado o tutorial [CRUD Simples - Nodejs (express, typescript) - single server](../tutorial/crud-simples-monoservidor-nodejs-typescript-express-sqlite.md) como base para a revis√£o de conceitos e apresenta√ß√£o de novos conceitos.

- T√≥picos abordados
  - Cliente x Servidor
    - Protocolo
    - Endere√ßo IP
    - Porta
    - URL
  - Protocolo HTTP
    - Requisi√ß√µes
      - M√©todos
    - Respostas
      - C√≥digos de status
  - HTML / CSS / Javascript
  - Node.js (NPM)
    - Inicializa√ß√£o de projeto (`package.json`)
    - Instala√ß√£o de pacotes/modulos
      - Produ√ß√£o vs Desenvolvimento
    - Pacotes utilizados no projeto de exemplo
      - Depend√™ncias de Produ√ß√£o
        - [Express](https://npmjs.com/package/express)
        - [Sqlite](https://npmjs.com/package/sqlite)
        - [Sqlite3](https://npmjs.com/package/sqlite3)
      - Depend√™ncias de Desenvolvimento
        - [Nodemon](https://npmjs.com/package/nodemon)
        - [Ts-node](https://npmjs.com/package/ts-node)
        - [TypeScript](https://npmjs.com/package/typescript)
        - [@types/express](https://npmjs.com/package/@types/express)
  - Typescript
    - Compila√ß√£o vs Transpila√ß√£o
    - inicializa√ß√£o de projeto (`tsconfig.json`)

> üí° Curiosidades Citadas em Aula
> - [üì∫ A Hist√≥ria da Internet - A Guerra dos Navegadores](https://www.youtube.com/watch?v=_TW45Wctsmg) 
> - [üì∫ A hist√≥ria da guerra dos navegadores - TecMundo](https://www.youtube.com/watch?v=3yTDZTKwj-o) 
> - [üì∫ JovemScript - A HIST√ìRIA COMPLETA: JAVASCRIPT](https://www.youtube.com/watch?v=QM83eQ7Kpbg)